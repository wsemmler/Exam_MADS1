<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LDA Topic Distribution</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  background: #fafafa;
}

.tabs {
  display: flex;
  border-bottom: 2px solid #ccc;
  margin-bottom: 15px;
}

.tab {
  padding: 10px 20px;
  cursor: pointer;
  background: #eee;
  border-top-left-radius: 8px;
  border-top-right-radius: 8px;
  margin-right: 2px;
  font-weight: bold;
}

.tab.active {
  background: white;
  border-bottom: 2px solid white;
}

.tab-content {
  display: none;
  background: white;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.tab-content.active {
  display: block;
}

iframe {
  width: 100%;
  height: 600px;
  border: 1px solid #ccc;
  border-radius: 8px;
}
</style>
</head>
<body>

<h1>Latent Dirichlet Allocation (LDA)</h1>

<div class="tabs">
  <div class="tab active" onclick="showTab('lda')">LDA Topic Distribution</div>
  <div class="tab" onclick="showTab('viz')">Visualization</div>
  <div class="tab" onclick="showTab('pdf')">PDF Explanation</div>
</div>

<!-- Tab LDA -->
<div id="lda" class="tab-content active">
  <p style="margin-bottom:10px; color:#000000;">
      This is a demo of articles 0 – 9999 from the original 306,243 articles.
  </p>
  <div class="controls">
    <label>Document ID:</label>
    <input type="number" id="doc_id" value="9999" min="0">
    <button onclick="showTopics()">Show</button>
    <button onclick="prevDoc()">◀ Prev</button>
    <button onclick="nextDoc()">Next ▶</button>
    <div id="status">Loading data...</div>
  </div>

  <div class="box">
    <h3>Article Text</h3>
    <div id="textBox">Waiting for document...</div>
  </div>

  <div class="container" style="display: flex; gap: 20px; align-items: flex-start; margin-top: 20px;">
    <div class="box" style="flex: 1;">
      <h3>Topics</h3>
      <div id="topicsBox">No topics yet</div>
    </div>
    <div class="box" style="flex: 5;">
      <h3>Topics Heatmap</h3>
      <img class="heatmap" src="heatmap.png" alt="Top words per topic heatmap" style="width:110%; max-width:900px;">
    </div>
  </div>
</div>

<div id="viz" class="tab-content">
  <h3>Visualization</h3>
  <div class="container" style="display:flex; gap:20px; flex-wrap:wrap; align-items:flex-start;">
    <div class="box" style="flex:1 1 45%; min-width:600px;">
      <h4>Raw Text</h4>
      <img src="raw_text.png" alt="Raw text visualization" style="width:100%; max-width:1000px; border-radius:8px; border:1px solid #ccc;">
    </div>
    <div class="box" style="flex:1 1 45%; min-width:600px;">
      <h4>Cleaned Text</h4>
      <img src="cleaned_text.png" alt="Cleaned text visualization" style="width:100%; max-width:1000px; border-radius:8px; border:1px solid #ccc;">
    </div>
    <div class="box" style="flex:1 1 100%; margin-top:20px;">
      <h4>LDA Interactive</h4>
       <iframe src="lda_10.html" style="width:100%; height:800px; border:1px solid #ccc; border-radius:8px;"></iframe>
    </div>
  </div>
</div>

<!-- Tab PDF -->
<div id="pdf" class="tab-content">
  <h3>PDF Explanation</h3>
  <div style="overflow: auto; width: 100%; height: 600px; border: 1px solid #ccc; border-radius: 8px;">
    <iframe 
      src="Semmler_Exam_Mads1.pdf" 
      style="width:65%; height:100%; transform: scale(1.5); transform-origin: 0 0; border: none;">
    </iframe>
  </div>
</div>


<script>
// SWITCH 
function showTab(tabId) {

  document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
  document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
}

// LDA 
let topicsData = {};
let textsIndex = {};
let maxDocId = 0;
let dataLoaded = false;

const statusEl = document.getElementById("status");
const textBox = document.getElementById("textBox");
const topicsBox = document.getElementById("topicsBox");

async function loadData() {
    statusEl.innerText = "Loading topics...";
    topicsData = await fetch("demo_topics.json").then(r => r.json());

    statusEl.innerText = "Loading texts...";
    textsIndex = await fetch("demo_texts.json").then(r => r.json());

    maxDocId = Math.max(...Object.keys(topicsData).map(Number));
    dataLoaded = true;
    statusEl.innerText = "Data loaded ✔";
}

loadData();

async function showTopics() {
    if (!dataLoaded) {
        statusEl.innerText = "Data still loading...";
        return;
    }

    const docId = document.getElementById("doc_id").value.toString();

    if (!topicsData.hasOwnProperty(docId)) {
        textBox.innerText = "Document not found.";
        topicsBox.innerText = "";
        return;
    }

    const text = textsIndex[docId] || "[Text not available]";
    const topics = topicsData[docId];

    textBox.innerText = text;

    let html = "";
    topics.forEach(([topic_id, prob]) => {
        html += `<div class="topic">
            <b>Topic ${parseInt(topic_id)}</b> — ${(prob*100).toFixed(2)}%
        </div>`;
    });
    topicsBox.innerHTML = html;
}

function prevDoc() {
    const input = document.getElementById("doc_id");
    input.value = Math.max(1, parseInt(input.value)-1);
    showTopics();
}

function nextDoc() {
    const input = document.getElementById("doc_id");
    input.value = Math.min(maxDocId, parseInt(input.value)+1);
    showTopics();
}
</script>
</body>
</html>